<!DOCTYPE html>
<html>
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>

<head>
    <meta charset="UTF-8">
    <title>Canvas</title>
    <style type="text/css">
        body {
            background-color: white;
        }
    </style>
</head>

<body>
    <canvas id="canvas-for-ball" style="border:1px solid #000000;" height="400" width="400"></canvas>
    <script type="text/javascript">
        // Gets a handle to the element with id canvasOne.
        var canvas = document.getElementById("canvas-for-ball");
        // Get a 2D context for the canvas.
        var ctx = canvas.getContext("2d");
        //"Physics" variables
        var gravity = 0.1; // gravity

        var iMax = 7;
        var jMax = 8;
        var orbs = new Array();

        for (i = 0; i < iMax; i++) {
            orbs[i] = new Array();
            for (j = 0; j < jMax; j++) {
                orbs[i][j] = new Ball(50 * (i + 1), 50 * -(j + 1), 25, 1);
            }
        }

        //Ball Object
        function Ball(x, y, r, vec) {
            this.x = x;
            this.y = y;
            this.r = r;
            this.yspeed = vec;
            this.color = "white"
            this.selected = false;
            //Ball's Functions
            this.draw = function() {
                //Draw circle
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2, false);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.stroke();
                //Draw circle within circle
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.r * 0.9, 0, Math.PI * 2, false);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.stroke();
            };
            this.move = function(xpos, ypos) {
                //Change circle location
                this.x = xpos;
                this.y = ypos;
            };
            this.setColor = function(color) {
                console.log(color);
                this.color = color;
                this.draw();

            };
        }



        canvas.addEventListener("click", function(event) {
            console.log("click");
            iTemp = -1;
            jTemp = -1;
            dummyBall = new Ball(event.clientX - canvas.offsetLeft, event.clientY - canvas.offsetTop, 1, 0);
            for (var i = 0; i < iMax; i++) {
                for (var j = 0; j < jMax; i++) {
                  var b1 = orbs[i][j].x - dummyBall.x;
                    if (Math.sqrt((b1*b1) + (b1*b1)) < orbs[i][j].r) {
                        iTemp = i;
                        jTemp = j;
                    }
                }
            }
            var uball = orbs.splice(iTemp, jTemp, 1);
            orbs.push(new Ball(50 * (iTemp + 1), -25, 25, 1));
            //ball1.move(event.clientX - canvas.offsetLeft, event.clientY - canvas.offsetTop);
        });


        function intersection(b1, b2) {
            var a, dx, dy, d;
            /* dx and dy are the vertical and horizontal distances between
             * the circle centers.
             */
            dx = b2.x - b1.x;
            dy = b2.y - b1.y;
            /* Determine the straight-line distance between the centers. */
            d = Math.sqrt((dy * dy) + (dx * dx));
            /* Check for solvability. */
            if ((d > (b1.r + b2.r)) || (d < Math.abs(b1.r - b2.r))) {
                /* no solution. circles do not intersect. */
                return false;
            }
            return true;
        }


        function animation() {
            //Clear Canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (var i = 0; i < iMax; i++) {
                for (var j = 0; j < jMax; j++) {
                    orbs[i][j].yspeed = 1;
                    for (var k = 0; k < iMax; k++) {
                        for (var l = 0; l < jMax; l++) {
                            if (intersection(orbs[i][j], orbs[k][l])) {
                                if (orbs[i][j].y < orbs[k][l].y) {
                                    orbs[i][j].yspeed = 0;
                                }
                            }
                        }
                    }
                    // handle bouncing and (y)border collision
                    if ((orbs[i][j].y > canvas.height - (orbs[i][j].r + 1))) {
                        // Update the y vector.
                        orbs[i][j].yspeed = 0;

                    }
                    orbs[i][j].move((orbs[i][j].x), (orbs[i][j].y += orbs[i][j].yspeed * 5));
                    orbs[i][j].draw();
                }
            }
            //Recursive call
            window.requestAnimationFrame(animation);
        }
        //Get the animation going.
        //repeatme();
        animation();
    </script>
</body>

</html>
